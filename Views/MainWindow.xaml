<Window x:Class="CANalyzer.WPF.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:oxy="http://oxyplot.org/wpf"
        xmlns:local="clr-namespace:CANalyzer.WPF.Views"
        mc:Ignorable="d"
        Title="CANalyzer - Advanced CAN Bus Analyzer" 
        Height="900" Width="1600"
        WindowStartupLocation="CenterScreen">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Toolbar -->
        <ToolBar Grid.Row="0" Margin="5">
            <Button x:Name="btnLoadLog" Content="ðŸ“ Load CAN Log" Click="BtnLoadLog_Click" ToolTip="Load CAN log file"/>
            <Separator/>
            <Button x:Name="btnAnalyze" Content="ðŸ” Analyze" Click="BtnAnalyze_Click" ToolTip="Start analysis"/>
            <Button x:Name="btnGenerateDBC" Content="ðŸ“„ Generate DBC" Click="BtnGenerateDBC_Click" ToolTip="Generate DBC file"/>
            <Separator/>
            <Button x:Name="btnRunPipeline" Content="ðŸ”„ Reverse Engineering" Click="BtnRunPipeline_Click" ToolTip="Run reverse engineering pipeline"/>
            <Separator/>
            <Button x:Name="btnExport" Content="ðŸ’¾ Export Results" Click="BtnExport_Click"/>
            <Button x:Name="btnSettings" Content="âš™ Settings" Click="BtnSettings_Click"/>
        </ToolBar>
        
        <!-- Main Content Area with 4 windows -->
        <TabControl Grid.Row="1" Margin="5">
            <TabItem Header="ðŸ“Š Raw Data">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                        <TextBlock Text="File: " FontWeight="Bold" VerticalAlignment="Center"/>
                        <TextBlock x:Name="txtFileName" Text="No file loaded" Margin="10,0" VerticalAlignment="Center"/>
                        <TextBlock Text="Messages: " FontWeight="Bold" VerticalAlignment="Center" Margin="20,0,0,0"/>
                        <TextBlock x:Name="txtMessageCount" Text="0" VerticalAlignment="Center"/>
                    </StackPanel>
                    
                    <DataGrid x:Name="dgRawData" Grid.Row="1" Margin="5"
                             AutoGenerateColumns="False" 
                             IsReadOnly="True"
                             CanUserAddRows="False"
                             CanUserDeleteRows="False"
                             SelectionMode="Single"
                             ScrollViewer.CanContentScroll="True"
                             ScrollViewer.VerticalScrollBarVisibility="Auto">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Time" Binding="{Binding Timestamp}" Width="100"/>
                            <DataGridTextColumn Header="Channel" Binding="{Binding Channel}" Width="70"/>
                            <DataGridTextColumn Header="ID" Binding="{Binding ID}" Width="70"/>
                            <DataGridTextColumn Header="DLC" Binding="{Binding DLC}" Width="50"/>
                            <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="70"/>
                            <DataGridTextColumn Header="Data" Binding="{Binding DataHex}" Width="Auto" MinWidth="200"/>
                            <DataGridTextColumn Header="Signals" Binding="{Binding SignalsCount}" Width="70"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>
            
            <TabItem Header="ðŸ“ˆ Decoded Signals">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="300"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Signal List -->
                    <ListView x:Name="lvSignals" Grid.Column="0" Margin="5"
                             SelectionChanged="LvSignals_SelectionChanged">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="Name" DisplayMemberBinding="{Binding Name}" Width="150"/>
                                <GridViewColumn Header="Type" DisplayMemberBinding="{Binding SignalType}" Width="80"/>
                                <GridViewColumn Header="Message" DisplayMemberBinding="{Binding MessageID, StringFormat=X}" Width="70"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                    
                    <!-- Signal Details and Plot -->
                    <Grid Grid.Column="1" Margin="5">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <GroupBox Grid.Row="0" Header="Signal Details" Margin="5">
                            <StackPanel>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Name:" FontWeight="Bold" Margin="5"/>
                                    <TextBlock x:Name="txtSignalName" Grid.Row="0" Grid.Column="1" Margin="5"/>
                                    
                                    <TextBlock Grid.Row="0" Grid.Column="2" Text="Range:" FontWeight="Bold" Margin="5"/>
                                    <TextBlock x:Name="txtSignalRange" Grid.Row="0" Grid.Column="3" Margin="5"/>
                                    
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Bits:" FontWeight="Bold" Margin="5"/>
                                    <TextBlock x:Name="txtSignalBits" Grid.Row="1" Grid.Column="1" Margin="5"/>
                                    
                                    <TextBlock Grid.Row="1" Grid.Column="2" Text="Unit:" FontWeight="Bold" Margin="5"/>
                                    <TextBlock x:Name="txtSignalUnit" Grid.Row="1" Grid.Column="3" Margin="5"/>
                                    
                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Scaling:" FontWeight="Bold" Margin="5"/>
                                    <TextBlock x:Name="txtSignalScaling" Grid.Row="2" Grid.Column="1" Margin="5"/>
                                    
                                    <TextBlock Grid.Row="2" Grid.Column="2" Text="Classification:" FontWeight="Bold" Margin="5"/>
                                    <TextBlock x:Name="txtSignalClassification" Grid.Row="2" Grid.Column="3" Margin="5"/>
                                </Grid>
                            </StackPanel>
                        </GroupBox>
                        
                        <!-- Signal Plot -->
                        <GroupBox Grid.Row="1" Header="Signal Visualization" Margin="5">
                            <oxy:PlotView x:Name="signalPlot" Model="{Binding SignalPlotModel}"/>
                        </GroupBox>
                    </Grid>
                </Grid>
            </TabItem>
            
            <TabItem Header="ðŸ”— Correlations">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="300"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Correlation List -->
                    <ListView x:Name="lvCorrelations" Grid.Column="0" Margin="5"
                             SelectionChanged="LvCorrelations_SelectionChanged">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="Signal A" DisplayMemberBinding="{Binding SignalAName}" Width="120"/>
                                <GridViewColumn Header="Signal B" DisplayMemberBinding="{Binding SignalBName}" Width="120"/>
                                <GridViewColumn Header="Correlation" DisplayMemberBinding="{Binding Correlation, StringFormat=F3}" Width="80"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                    
                    <!-- Correlation Details and Plot -->
                    <Grid Grid.Column="1" Margin="5">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                            <TextBlock Text="Selected Correlation: " FontWeight="Bold"/>
                            <TextBlock x:Name="txtCorrelationDetails" Margin="10,0"/>
                        </StackPanel>
                        
                        <!-- Correlation Plot -->
                        <GroupBox Grid.Row="1" Header="Correlation Visualization" Margin="5">
                            <oxy:PlotView x:Name="correlationPlot" Model="{Binding CorrelationPlotModel}"/>
                        </GroupBox>
                    </Grid>
                </Grid>
            </TabItem>
            
            <!-- ÐÐ¾Ð²Ð°Ñ Ð²ÐºÐ»Ð°Ð´ÐºÐ° Ð´Ð»Ñ Reverse Engineering -->
            <TabItem Header="ðŸ”¬ Reverse Engineering">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Toolbar Ð´Ð»Ñ Reverse Engineering -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                        <Button x:Name="btnPreProcess" Content="Pre-Process" Click="BtnPreProcess_Click" Margin="5" Width="100"/>
                        <Button x:Name="btnLexicalAnalysis" Content="Lexical Analysis" Click="BtnLexicalAnalysis_Click" Margin="5" Width="100"/>
                        <Button x:Name="btnSemanticAnalysis" Content="Semantic Analysis" Click="BtnSemanticAnalysis_Click" Margin="5" Width="100"/>
                        <Button x:Name="btnExportPipeline" Content="Export Results" Click="BtnExportPipeline_Click" Margin="5" Width="100"/>
                    </StackPanel>
                    
                    <!-- ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ -->
                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="300"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="300"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Ð›ÐµÐ²Ð°Ñ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ°: ArbIDs Ð¸ Ð¡Ð¸Ð³Ð½Ð°Ð»Ñ‹ -->
                        <Grid Grid.Column="0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <!-- ArbIDs -->
                            <GroupBox Grid.Row="0" Header="ArbIDs" Margin="5">
                                <DataGrid x:Name="dgPipelineArbIDs" AutoGenerateColumns="False" IsReadOnly="True"
                                         SelectionMode="Single" CanUserAddRows="False" CanUserDeleteRows="False">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="ID" Binding="{Binding ID}" Width="60"/>
                                        <DataGridTextColumn Header="Count" Binding="{Binding MessageCount}" Width="60"/>
                                        <DataGridTextColumn Header="Freq" Binding="{Binding Frequency}" Width="60"/>
                                        <DataGridTextColumn Header="DLC" Binding="{Binding DLC}" Width="40"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </GroupBox>
                            
                            <!-- Ð¡Ð¸Ð³Ð½Ð°Ð»Ñ‹ -->
                            <GroupBox Grid.Row="1" Header="Detected Signals" Margin="5">
                                <ListView x:Name="lvPipelineSignals" SelectionChanged="LvPipelineSignals_SelectionChanged">
                                    <ListView.View>
                                        <GridView>
                                            <GridViewColumn Header="Name" DisplayMemberBinding="{Binding Name}" Width="120"/>
                                            <GridViewColumn Header="Byte" DisplayMemberBinding="{Binding Byte}" Width="40"/>
                                            <GridViewColumn Header="Type" DisplayMemberBinding="{Binding Type}" Width="60"/>
                                        </GridView>
                                    </ListView.View>
                                </ListView>
                            </GroupBox>
                        </Grid>
                        
                        <!-- Ð¦ÐµÐ½Ñ‚Ñ€Ð°Ð»ÑŒÐ½Ð°Ñ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ°: Ð“Ñ€Ð°Ñ„Ð¸ÐºÐ¸ -->
                        <Grid Grid.Column="1">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Pipeline Signal Plot -->
                            <GroupBox Grid.Row="0" Header="Signal Plot" Margin="5">
                                <oxy:PlotView x:Name="pipelinePlot" Model="{Binding PipelinePlotModel}"/>
                            </GroupBox>
                            
                            <!-- Cluster Plot -->
                            <GroupBox Grid.Row="1" Header="Cluster Plot" Margin="5">
                                <oxy:PlotView x:Name="clusterPlot" Model="{Binding ClusterPlotModel}"/>
                            </GroupBox>
                        </Grid>
                        
                        <!-- ÐŸÑ€Ð°Ð²Ð°Ñ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ°: Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¸ ÐšÐ»Ð°ÑÑ‚ÐµÑ€Ñ‹ -->
                        <Grid Grid.Column="2">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Ð”ÐµÑ‚Ð°Ð»Ð¸ ÑÐ¸Ð³Ð½Ð°Ð»Ð° -->
                            <GroupBox Grid.Row="0" Header="Signal Details" Margin="5">
                                <StackPanel Margin="5">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        
                                        <StackPanel Grid.Row="0" Orientation="Horizontal">
                                            <TextBlock Text="ArbID:" FontWeight="Bold" Width="100"/>
                                            <TextBlock x:Name="txtPipelineArbID" Margin="5,0"/>
                                        </StackPanel>
                                        
                                        <StackPanel Grid.Row="1" Orientation="Horizontal">
                                            <TextBlock Text="Byte:" FontWeight="Bold" Width="100"/>
                                            <TextBlock x:Name="txtPipelineByte" Margin="5,0"/>
                                        </StackPanel>
                                        
                                        <StackPanel Grid.Row="2" Orientation="Horizontal">
                                            <TextBlock Text="Range:" FontWeight="Bold" Width="100"/>
                                            <TextBlock x:Name="txtPipelineRange" Margin="5,0"/>
                                        </StackPanel>
                                        
                                        <StackPanel Grid.Row="3" Orientation="Horizontal">
                                            <TextBlock Text="Unique Values:" FontWeight="Bold" Width="100"/>
                                            <TextBlock x:Name="txtPipelineUnique" Margin="5,0"/>
                                        </StackPanel>
                                        
                                        <StackPanel Grid.Row="4" Orientation="Horizontal">
                                            <TextBlock Text="Mean:" FontWeight="Bold" Width="100"/>
                                            <TextBlock x:Name="txtPipelineMean" Margin="5,0"/>
                                        </StackPanel>
                                        
                                        <StackPanel Grid.Row="5" Orientation="Horizontal">
                                            <TextBlock Text="Std Dev:" FontWeight="Bold" Width="100"/>
                                            <TextBlock x:Name="txtPipelineStdDev" Margin="5,0"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </GroupBox>
                            
                            <!-- ÐšÐ»Ð°ÑÑ‚ÐµÑ€Ñ‹ -->
                            <GroupBox Grid.Row="1" Header="Clusters" Margin="5">
                                <StackPanel>
                                    <ListView x:Name="lvClusters" SelectionChanged="LvClusters_SelectionChanged" Height="150">
                                        <ListView.View>
                                            <GridView>
                                                <GridViewColumn Header="Cluster" DisplayMemberBinding="{Binding ClusterId}" Width="60"/>
                                                <GridViewColumn Header="Signals" DisplayMemberBinding="{Binding SignalCount}" Width="60"/>
                                                <GridViewColumn Header="Sample" DisplayMemberBinding="{Binding SignalNames}" Width="150"/>
                                            </GridView>
                                        </ListView.View>
                                    </ListView>
                                    <TextBlock x:Name="txtClusterInfo" Margin="5" FontWeight="Bold"/>
                                </StackPanel>
                            </GroupBox>
                        </Grid>
                    </Grid>
                </Grid>
            </TabItem>
        </TabControl>
        
        <!-- Status Bar -->
        <StatusBar Grid.Row="2" Margin="5">
            <StatusBarItem>
                <TextBlock x:Name="txtStatus" Text="Ready"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <ProgressBar x:Name="progressBar" Width="200" Height="20" IsIndeterminate="False"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="txtProgress" Text=""/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>